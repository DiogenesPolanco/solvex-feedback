/*!
 * solvex-feedback
 * 
 * Version: 1.0.8 - 2017-01-27T15:47:40.128Z
 * License: MIT
 */
"use strict";var MicrosoftGraph={};!function(e,t,a){if(e.solvexFeedback===a){var s,n=function(t){e.console.log(t)},i=function(e){for(var t=0,a=e.length;t<a;t++)e[t]&&e[t].remove()},o=function(){var e=t.createElement("div"),a=3;for(e.className="feedback-loader";a--;)e.appendChild(t.createElement("span"));return e},l=function(e){return e.getBoundingClientRect()},c=function(e){for(var t;null!==(t=e.firstChild)&&e.removeChild(t););},r=function(e,a){var s=t.createElement(e);return s.appendChild(t.createTextNode(a)),s},d=function(t,s){if(t.onload!==a)return s;if(t.onreadystatechange!==a){var i=function(){"loaded"!==t.readyState&&"complete"!==t.readyState?e.setTimeout(i,250):s()};e.setTimeout(i,250)}else n("ERROR: We can't track when script is loaded")},h="data-html2canvas-ignore",p=t.createElement("div");e.solvexFeedback=function(n){n=n||{},n.label=n.label||"Solvex Feedback",n.header=n.header||"Solvex Feedback",n.url=n.url||"/",n.adapter=n.adapter||new e.solvexFeedback.XHR(n.url),n.nextLabel=n.nextLabel||"Continue",n.reviewLabel=n.reviewLabel||"Review",n.sendLabel=n.sendLabel||"Send",n.closeLabel=n.closeLabel||"Close",n.messageSuccess=n.messageSuccess||"Your feedback was sent succesfully.",n.messageError=n.messageError||"There was an error sending your feedback to the server.",n.pages===a&&(n.pages=[new e.solvexFeedback.Form,new e.solvexFeedback.Screenshot(n),new e.solvexFeedback.Review]);var l,d,f,g=t.createElement("div"),m={open:function(){if(!n.useVSSAL||""!==sessionStorage.getItem("vssal.access.token.key")&&null!==sessionStorage.getItem("vssal.access.token.key")&&sessionStorage.getItem("vssal.access.token.key")!==a||"function"!=typeof n.LoginVSSAL)if(!n.useGraph||""!==sessionStorage.getItem("adal.access.token.keyhttps://graph.microsoft.com")&&null!==sessionStorage.getItem("adal.access.token.keyhttps://graph.microsoft.com")&&sessionStorage.getItem("adal.access.token.keyhttps://graph.microsoft.com")!==a&&n.tokenOffice!==a){var i=n.pages.length;for(f=0;f<i;f++)n.pages[f]instanceof e.solvexFeedback.Review||n.pages[f].render();var o=r("a","×"),u=t.createElement("div"),v=t.createElement("div");d=t.createElement("div"),t.body.appendChild(g),o.className="feedback-close",o.onclick=m.close,o.href="#",l.disabled=!0,u.appendChild(o),u.appendChild(r("h3",n.header)),u.className="feedback-header",p.className="feedback-body",c(p),f=0,p.appendChild(n.pages[f++].dom),s=r("button",n.nextLabel),s.className="feedback-btn",s.onclick=function(){f>0&&n.pages[f-1].end(d)===!1||(c(p),f===i?m.send(n.adapter):(n.pages[f].start(d,u,v,s),n.pages[f]instanceof e.solvexFeedback.Review&&n.pages[f].render(n.pages),p.appendChild(n.pages[f++].dom),f===i&&(s.firstChild.nodeValue=n.sendLabel),n.pages[f]instanceof e.solvexFeedback.Review&&(s.firstChild.nodeValue=n.reviewLabel)))},v.className="feedback-footer",v.appendChild(s),d.className="feedback-modal",d.setAttribute(h,!0),d.appendChild(u),d.appendChild(v),d.appendChild(p),t.body.appendChild(d)}else n.LoginGraph();else n.LoginVSSAL()},close:function(){l.disabled=!1,i([d,g]),f>0&&n.pages[f-1].end(d);for(var e=0,t=n.pages.length;e<t;e++)n.pages[e].close();return!1},send:function(a){if(!(a instanceof e.solvexFeedback.Send))throw new Error("Adapter is not an instance of Feedback.Send");for(var i,l=0,r=n.pages.length,d=[],h=0;l<r;l++)(i=n.pages[l].data())!==!1&&(d[h++]=i);s.disabled=!0,c(p),p.appendChild(o()),a.send(d,function(e){c(p),s.disabled=!1,s.firstChild.nodeValue=n.closeLabel,s.onclick=function(){return m.close(),!1},e===!0?p.appendChild(t.createTextNode(n.messageSuccess)):p.appendChild(t.createTextNode(n.messageError))})}};return g.className="feedback-glass",g.style.pointerEvents="none",g.setAttribute(h,!0),n=n||{},l=r("button",n.label),l.className="feedback-btn feedback-bottom-right",l.setAttribute(h,!0),l.onclick=m.open,null!==n.appendTo&&(n.appendTo!==a?n.appendTo:t.body).appendChild(l),m},e.solvexFeedback.Page=function(){},e.solvexFeedback.Page.prototype={render:function(e){this.dom=e},start:function(){},close:function(){},data:function(){return!1},review:function(){return null},end:function(){return!0}},e.solvexFeedback.Send=function(){},e.solvexFeedback.Send.prototype={send:function(){}},e.solvexFeedback.Form=function(e){this.elements=e||[{id:"comment",type:"textarea",name:"Issue",label:"Please describe the issue you are experiencing",required:!1}],this.dom=t.createElement("div")},e.solvexFeedback.Form.prototype=new e.solvexFeedback.Page,e.solvexFeedback.Form.prototype.render=function(){var e,a=0,s=this.elements.length;for(c(this.dom);a<s;a++)switch(e=this.elements[a],e.type){case"textarea":this.dom.appendChild(r("label",e.label+":"+(e.required===!0?" *":"")));var n=t.createElement("textarea");n.setAttribute("class","Div1"),this.dom.appendChild(e.element=n)}return this},e.solvexFeedback.Form.prototype.end=function(){for(var e,t=0,a=this.elements.length;t<a;t++){if(e=this.elements[t],e.required===!0&&0===e.element.value.length)return e.element.className="feedback-error",!1;e.element.className=""}return!0},e.solvexFeedback.Form.prototype.data=function(){if(this._data!==a)return this._data;for(var e,t=0,s=this.elements.length,n={};t<s;t++)e=this.elements[t],n[e.name]=e.element.value;return this._data=n},e.solvexFeedback.Form.prototype.review=function(e){for(var a,s=0,n=this.elements.length;s<n;s++)a=this.elements[s],a.element.value.length>0&&(e.appendChild(t.createTextNode(a.element.value)),e.appendChild(t.createElement("hr")));return e},e.solvexFeedback.Review=function(){this.dom=t.createElement("div"),this.dom.className="feedback-review"},e.solvexFeedback.Review.prototype=new e.solvexFeedback.Page,e.solvexFeedback.Review.prototype.render=function(e){var t=0,a=e.length;for(c(this.dom);t<a;t++)e[t].review(this.dom);return this},e.solvexFeedback.Screenshot=function(e){this.options=e||{},this.options.blackoutClass=this.options.blackoutClass||"feedback-blackedout",this.options.highlightClass=this.options.highlightClass||"feedback-highlighted",this.h2cDone=!1},e.solvexFeedback.Screenshot.prototype=new e.solvexFeedback.Page,e.solvexFeedback.Screenshot.prototype.end=function(e){e.className=e.className.replace(/feedback\-animate\-toside/,""),t.body.removeEventListener("mousemove",this.mouseMoveEvent,!1),t.body.removeEventListener("click",this.mouseClickEvent,!1),i([this.h2cCanvas]),this.h2cDone=!1},e.solvexFeedback.Screenshot.prototype.close=function(){i([this.blackoutBox,this.highlightContainer,this.highlightBox,this.highlightClose]),i(t.getElementsByClassName(this.options.blackoutClass)),i(t.getElementsByClassName(this.options.highlightClass))},e.solvexFeedback.Screenshot.prototype.start=function(s,n,i,d){if(this.h2cDone){c(this.dom),d.disabled=!1;var h=this,p="feedback-highlight-element",f="data-exclude",g=!0;this.mouseMoveEvent=function(t){if(t.target!==v&&(t.target.className.indexOf(h.options.blackoutClass)!==-1||t.target.className.indexOf(h.options.highlightClass)!==-1)){var i=parseInt(t.target.style.left,10)+parseInt(t.target.style.width,10);i=Math.max(i,10),i=Math.min(i,e.innerWidth-15);var o=parseInt(t.target.style.top,10);return o=Math.max(o,10),b.style.left=i+"px",b.style.top=o+"px",u=t.target,F(),void(v=a)}return"BODY"===t.target.nodeName||t.target===b||t.target===s||t.target===d||t.target.parentNode===s||t.target.parentNode===n?(F(),void(v=t.target)):(S(),void(t.target!==v&&(v=t.target,e.clearTimeout(m),m=e.setTimeout(function(){var t,a=l(v);g===!1?t=x:(t=k,t.width=a.width,t.height=a.height,C.drawImage(h.h2cCanvas,e.pageXOffset+a.left,e.pageYOffset+a.top,a.width,a.height,0,0,a.width,a.height)),t.setAttribute(f,!1),t.style.left=e.pageXOffset+a.left+"px",t.style.top=e.pageYOffset+a.top+"px",t.style.width=a.width+"px",t.style.height=a.height+"px"},100))))},this.mouseClickEvent=function(e){if(e.preventDefault(),g===!1){if("false"===x.getAttribute(f)){var s=t.createElement("div");s.className=h.options.blackoutClass,s.style.left=x.style.left,s.style.top=x.style.top,s.style.width=x.style.width,s.style.height=x.style.height,t.body.appendChild(s),v=a}}else"false"===k.getAttribute(f)&&(k.className+=" "+h.options.highlightClass,k.className=k.className.replace(/feedback\-highlight\-element/g,""),h.highlightBox=k=t.createElement("canvas"),C=k.getContext("2d"),k.className+=" "+p,t.body.appendChild(k),F(),v=a)},this.highlightClose=r("div","×"),this.blackoutBox=t.createElement("div"),this.highlightBox=t.createElement("canvas"),this.highlightContainer=t.createElement("div");var m,u,v,b=this.highlightClose,k=this.highlightBox,x=this.blackoutBox,y=this.highlightContainer,C=k.getContext("2d"),w=function(e){e.preventDefault(),E.className.indexOf("active")===-1?(E.className+=" active",T.className=T.className.replace(/active/g,"")):(T.className+=" active",E.className=E.className.replace(/active/g,"")),g=!g},F=function(){N(x),N(k),e.clearTimeout(m)},N=function(e){e.style.left="-5px",e.style.top="-5px",e.style.width="0px",e.style.height="0px",e.setAttribute(f,!0)},S=function(){b.style.left="-50px",b.style.top="-50px"},E=r("a","Blackout"),T=r("a","Highlight");s.className+=" feedback-animate-toside",b.id="feedback-highlight-close",b.addEventListener("click",function(){u.parentNode.removeChild(u),S()},!1),t.body.appendChild(b),this.h2cCanvas.className="feedback-canvas",t.body.appendChild(this.h2cCanvas);var L=[T,E];this.dom.appendChild(r("p","Highlight or blackout important information"));for(var R=0;R<2;R++)L[R].className="feedback-btn feedback-btn-small "+(0===R?"active":"feedback-btn-inverse"),L[R].href="#",L[R].onclick=w,this.dom.appendChild(L[R]),this.dom.appendChild(t.createTextNode(" "));y.id="feedback-highlight-container",y.style.width=this.h2cCanvas.width+"px",y.style.height=this.h2cCanvas.height+"px",this.highlightBox.className+=" "+p,this.blackoutBox.id="feedback-blackout-element",t.body.appendChild(this.highlightBox),y.appendChild(this.blackoutBox),t.body.appendChild(y),t.body.addEventListener("mousemove",this.mouseMoveEvent,!1),t.body.addEventListener("click",this.mouseClickEvent,!1)}else{var A=arguments;d.disabled!==!0&&this.dom.appendChild(o()),d.disabled=!0,e.setTimeout(function(){h.start.apply(h,A)},500)}},e.solvexFeedback.Screenshot.prototype.render=function(){this.dom=t.createElement("div");var s,i=this,o=this.options,l=function(){try{o.onrendered=o.onrendered||function(e){i.h2cCanvas=e,i.h2cDone=!0},e.html2canvas([t.body],o)}catch(a){i.h2cDone=!0,n("Error in html2canvas: "+a.message)}};if(e.html2canvas===a&&s===a){s=t.createElement("script"),s.src=o.h2cPath||"https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js",s.onerror=function(){n("Failed to load html2canvas library, check that the path is correctly defined")},s.onload=d(s,function(){return e.html2canvas===a?void n("Loaded html2canvas, but library not found"):(e.html2canvas.logging=e.solvexFeedback.debug,void l())});var c=t.getElementsByTagName("script")[0];c.parentNode.insertBefore(s,c)}else l();return this},e.solvexFeedback.Screenshot.prototype.data=function(){if(this._data!==a)return this._data;if(this.h2cCanvas!==a){var e,s,n=this.h2cCanvas.getContext("2d"),i=5;n.fillStyle="#000",Array.prototype.slice.call(t.getElementsByClassName("feedback-blackedout"),0).forEach(function(e){var t=l(e);n.fillRect(t.left,t.top,t.width,t.height)});var o=Array.prototype.slice.call(t.getElementsByClassName("feedback-highlighted"),0);o.length>0&&(e=t.createElement("canvas"),s=e.getContext("2d"),e.width=this.h2cCanvas.width,e.height=this.h2cCanvas.height,s.drawImage(this.h2cCanvas,0,0),n.fillStyle="#777",n.globalAlpha=.5,n.fillRect(0,0,this.h2cCanvas.width,this.h2cCanvas.height),n.beginPath(),o.forEach(function(e){var t=parseInt(e.style.left,10),a=parseInt(e.style.top,10),s=parseInt(e.style.width,10),o=parseInt(e.style.height,10);n.moveTo(t+i,a),n.lineTo(t+s-i,a),n.quadraticCurveTo(t+s,a,t+s,a+i),n.lineTo(t+s,a+o-i),n.quadraticCurveTo(t+s,a+o,t+s-i,a+o),n.lineTo(t+i,a+o),n.quadraticCurveTo(t,a+o,t,a+o-i),n.lineTo(t,a+i),n.quadraticCurveTo(t,a,t+i,a)}),n.closePath(),n.clip(),n.globalAlpha=1,n.drawImage(e,0,0));try{return this._data=this.h2cCanvas.toDataURL()}catch(c){}}},e.solvexFeedback.Screenshot.prototype.review=function(e){var t=this.data();if(t!==a){var s=new Image;s.src=t,s.style.width="100%",e.appendChild(s)}},e.solvexFeedback.XHR=function(e){this.xhr=new XMLHttpRequest,this.url=e},e.solvexFeedback.XHR.prototype=new e.solvexFeedback.Send,e.solvexFeedback.XHR.prototype.send=function(t,a){var s=this.xhr;s.onreadystatechange=function(){4==s.readyState&&a(200===s.status)},s.open("POST",this.url,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.send("data="+encodeURIComponent(e.JSON.stringify(t)))}}}(window,document),angular.module("solvex.feedback",[]).directive("solvexFeedback",function(){return{restrict:"AE",templateUrl:"solvex-feedback.html",replace:!0,scope:!1,link:function(e,t){if(e.sxConfig.callback){var a=new window.solvexFeedback.Send;a.send=function(t,a){if("function"==typeof e.sxConfig.callback)if(e.sxConfig.useVSSAL)t[1]=t[1].replace("data:image/png;base64,",""),a(e.sxConfig.callback(t));else if(e.sxConfig.useGraph){var s=MicrosoftGraph.Client.init({debugLogging:!0,authProvider:function(t){t(null,void 0===e.sxConfig.tokenOffice?sessionStorage.getItem("adal.access.token.keyhttps://graph.microsoft.com"):e.sxConfig.tokenOffice)}});s.api("/me").get(function(n,i){if(n)throw n;if(void 0===i||null===i)a(!1);else{var o={Subject:e.sxConfig.feedbackSubject+" "+i.displayName,Body:{ContentType:"HTML",Content:t[0]},Attachments:[{"@odata.type":"#Microsoft.OutlookServices.FileAttachment",Name:"screenshot.png",ContentBytes:t[1].replace("data:image/png;base64,","")}],ToRecipients:[{EmailAddress:{Address:void 0!==e.sxConfig.feedbackMail?e.sxConfig.feedbackMail:e.sxConfig.feedbackContact}}]};s.api("/me/microsoft.graph.sendmail").post({message:o,saveToSentItems:!0},function(e,t){return e?void a(!0):void a(!1)})}})}else a(e.sxConfig.callback(t))},e.sxConfig.adapter=a}window.solvexFeedback(e.sxConfig)}}}),angular.module("solvex.feedback").run(["$templateCache",function(e){e.put("solvex-feedback.html",'<div class="solvex-feedback"><div id="feedback-welcome" class="feedback-hide"><p>Feedback lets you send us suggestions about our products. We welcome problem reports, feature ideas and general comments.</p><p>Start by writing a brief description:</p><textarea id="feedback-note-tmp"></textarea><p>Next we\\\'ll let you identify areas of the page related to your description.</p></div></div>')}]);